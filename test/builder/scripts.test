var Files =  {
	'main.js': `
		module.exports = {
			letters: require('./data/icons.js')
		};
	`,
	'data/icons.js': `
		module.exports = ['a', 'b'];
	`,
	'index.html': `
		<!doctype html>
		<script src='jquery.js' data-bundler='ignore' />
		<script src='main.js' />
	`
};

UTest({
	$before () {
		TestHelper.registerFiles(Files);
	},
	'should bundle commonjs scripts' () {
		return Bundler.clearCache().build('main.js', { 
			type: 'module',
			module: 'commonjs',
		}).done(resources => {
			eq_(resources.length, 1);
			var main = resources[0];

			eq_(main.url, 'build/release/main.js');


			var module = {};
			eval(main.content);
			deepEq_(module.exports.letters, ['a', 'b']);
		});
	},
	'!should get resources for html' () {
		return Bundler.clearCache().getResources('index.html').done(resources => {
			
			logger.log(resources.map(x => x.toJSON(false)));
		});
	},
	'should bundle scripts in html page' () {
		return Bundler.clearCache().build('index.html', {
			type: 'module',
			module: 'commonjs',
		}).done(resources => {
			eq_(resources.length, 1);
			var main = resources[0];


			logger.log(resources.length);
		});
	}
})